<section class="p-4 md:p-8 min-h-screen bg-base-200" aria-label="Panel de Administración">
  
  <header class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
    <h1 class="text-2xl md:text-3xl font-bold text-base-content text-center sm:text-left">Gestión de Usuarios</h1>
    
    <button (click)="loadRequests()" class="btn btn-ghost btn-sm w-full sm:w-auto border border-base-300 sm:border-none">
      Recargar
    </button>
  </header>

  @if (isLoading) {
    <div class="flex justify-center py-10" role="status">
      <span class="loading loading-spinner loading-lg text-primary"></span>
      <span class="sr-only">Cargando usuarios...</span> 
    </div>
  } @else {
    
    <div class="overflow-x-auto bg-base-100 shadow-xl rounded-lg">
      <table class="table align-middle">
        <caption class="sr-only">Lista de usuarios registrados y sus roles</caption>
        
        <thead class="bg-base-300 text-base-content">
          <tr>
            <th scope="col" class="min-w-[250px]">Usuario</th>
            <th scope="col" class="text-center">Rol Actual</th>
            <th scope="col" class="text-center min-w-[280px]">Asignar Rol</th>
          </tr>
        </thead>
        
        <tbody>
          @for (user of allUsers; track user.id) {
            <tr class="hover">
              
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="mask mask-squircle w-12 h-12">
                      <img [src]="user.photoURL || 'https://ui-avatars.com/api/?name='+user.email" alt="Avatar de {{user.name}}" />
                    </div>
                  </div>
                  <div>
                    <div class="font-bold truncate max-w-[150px] md:max-w-none">
                      {{ user.name || 'Sin nombre' }}
                    </div>
                    <div class="text-sm opacity-50 truncate max-w-[150px] md:max-w-none">
                      {{ user.email }}
                    </div>
                  </div>
                </div>
              </td>

              <td class="text-center">
                @if (user.role === 'ADMIN') {
                  <span class="badge badge-error text-white font-bold badge-sm md:badge-md">ADMIN</span>
                } @else if (user.role === 'PROGRAMMER') {
                  <span class="badge badge-primary text-white badge-sm md:badge-md">Programador</span>
                } @else {
                  <span class="badge badge-ghost badge-sm md:badge-md">Usuario</span>
                }
              </td>

              <td>
                <div class="flex flex-wrap justify-center gap-2">
                  
                  <button 
                    (click)="cambiarRol(user, 'USER')" 
                    class="btn btn-xs btn-ghost border-gray-300"
                    [disabled]="user.role === 'USER'"
                    aria-label="Degradar a Usuario">
                    Usuario
                  </button>

                  <button 
                    (click)="cambiarRol(user, 'PROGRAMMER')" 
                    class="btn btn-xs btn-primary text-white"
                    [disabled]="user.role === 'PROGRAMMER'"
                    aria-label="Ascender a Programador">
                    Programador
                  </button>

                  <button 
                    (click)="cambiarRol(user, 'ADMIN')" 
                    class="btn btn-xs btn-error text-white"
                    [disabled]="user.role === 'ADMIN'"
                    aria-label="Hacer Administrador">
                    Admin
                  </button>

                  <div class="divider divider-horizontal mx-0 hidden md:flex" role="separator"></div>

                  <button 
                    (click)="eliminarUsuario(user)" 
                    class="btn btn-xs btn-outline btn-error"
                    aria-label="Eliminar Usuario permanentemente">
                    Eliminar
                  </button>

                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }
</section>